<?php

/**
 * Recursively copy files from one directory to another
 *
 * @param String $src - Source of files being moved
 * @param String $dest - Destination of files being moved
 * @return bool
 */
if (!function_exists('dingodocs_xcopy')) {
    function dingodocs_xcopy($src, $dest)
    {

        // If source is not a directory stop processing
        if (!is_dir($src)) return false;

        // If the destination directory does not exist create it
        if (!is_dir($dest)) {
            if (!mkdir($dest)) {
                // If the destination directory could not be created stop processing
                return false;
            }
        }

        // Open the source directory to read in files
        $i = new DirectoryIterator($src);
        foreach ($i as $f) {
            if ($f->isFile()) {
                copy($f->getRealPath(), $dest . '/' . $f->getFilename());
            } else if (!$f->isDot() && $f->isDir()) {
                dingodocs_xcopy($f->getRealPath(), '$dest/$f');
            }
        }
    }
}

if (!function_exists('dingodocs_msg')) {
    function dingodocs_msg($type, $route, $output)
    {
        if(config('dingodocs.debug') == false) {
            if ($type == "I") return;
        }
        output('[' . $type . '] ' . $route->getAction()['uses'] . ' ' . $output);
    }
}

/**
 * Output the given text to the console.
 *
 * @param  string $output
 * @return void
 */
if (!function_exists('output')) {
    function output($output)
    {
        if (isset($_ENV['APP_ENV']) && $_ENV['APP_ENV'] == 'testing') {
            return;
        }
        (new Symfony\Component\Console\Output\ConsoleOutput)->writeln($output);
    }
}

if (!function_exists('dingodocs_formatJSON')) {
    function dingodocs_formatJSON( $json )
    {
        $result = '';
        $level = 0;
        $in_quotes = false;
        $in_escape = false;
        $ends_line_level = NULL;
        $json_length = strlen( $json );

        for( $i = 0; $i < $json_length; $i++ ) {
            $char = $json[$i];
            $new_line_level = NULL;
            $post = '';
            if( $ends_line_level !== NULL ) {
                $new_line_level = $ends_line_level;
                $ends_line_level = NULL;
            }
            if ( $in_escape ) {
                $in_escape = false;
            } else if( $char === '"' ) {
                $in_quotes = !$in_quotes;
            } else if( ! $in_quotes ) {
                switch( $char ) {
                    case '}': case ']':
                    $level--;
                    $ends_line_level = NULL;
                    $new_line_level = $level;
                    break;

                    case '{': case '[':
                    $level++;
                    case ',':
                        $ends_line_level = $level;
                        break;

                    case ':':
                        $post = ' ';
                        break;

                    case ' ': case '\t': case '\n': case '\r':
                    $char = '';
                    $ends_line_level = $new_line_level;
                    $new_line_level = NULL;
                    break;
                }
            } else if ( $char === '\\' ) {
                $in_escape = true;
            }
            if( $new_line_level !== NULL ) {
                $result .= '\n'.str_repeat( '\t', $new_line_level );
            }
            $result .= $char.$post;
        }

        return $result;
    }
}

if (!function_exists('isValidJSON')) {
    function isValidJSON($string) {
        json_decode($string);
        return (json_last_error() == JSON_ERROR_NONE);
    }
}



